<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>PIStatus - Main</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

    <style>
      .container{
        padding-top: 20px;
      }
     </style>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script>
    var singlecore = -1;
    var multicore = -1;
    var avrg_load;
    var uptime;
    var temp;
    var temp_flag;

    setInterval(function(){getData(event)}, 1500);

            function getData(event){

               $.ajax({
                    url: "dashboard/dashboard_json.php",
                    type: "POST",
                    success: function(data) { getDataResponse(data); }
               });
            }

            function getDataResponse(data) {

               var response = $.parseJSON(data);
               singlecore = response.singlecore;
               multicore = response.multicore;
               avrg_load = response.avrg_load;
               uptime = response.uptime;
               temp = response.temp;
               temp_flag = response.temp_flag;
               document.getElementById("multicore_field").innerHTML = (multicore.substr(0, ((multicore.length)-1))); //make 0.3% instead of 0.3 %
               document.getElementById("singlecore_field").innerHTML = singlecore; //make 0.3% instead of 0.3 %
               document.getElementById("avrg_load_field").innerHTML = avrg_load;
               document.getElementById("uptime_field").innerHTML = uptime;
               document.getElementById("temp_field").innerHTML = '<h3>Temp <span class="label label-'+temp_flag+'">'+temp+' C</span></h3>';
               document.getElementById("temp_flag").innerHTML = '<span class="label label-'+temp_flag+'">Status</span>';
               document.getElementById("uptime_flag").innerHTML = '<span class="label label-default">Status</span>';
               document.getElementById("cpu_flag").innerHTML = '<span class="label label-default">Status</span>';

            }


              setInterval(function(){setPushTemp()}, 1500);
                //Last TempPush Reason
                var lastTempPush;

              function setPushTemp(){
                  if(temp_flag==='warning' && temp_flag!==lastTempPush){
                                  Push.create('Temperature Warning!', {
                                      body: 'Temperature is above the point you set for warning.',
                                      icon: {
                                        x32: 'assets/icons/glyphicons-505-alert.png'
                                      },
                                      vibrate: [100],
                                      timeout: 5000

                                  });
                  }else if(temp_flag==='danger' && temp_flag!==lastTempPush){
                                  Push.create('Critical Temperature!', {
                                      body: 'Temperature is above the point you set for alert.',
                                      icon: {
                                        x32: 'assets/icons/glyphicons-505-alert.png'
                                      },
                                      vibrate: [200]
                                  });
                  }
                  if(temp_flag!==lastTempPush){
                    lastTempPush = temp_flag;
                  }
              }

    </script>

  </head>
  <body>
    <ul class="nav nav-tabs">
      <li role="presentation" class="active"><a href="index.html">Dashboard</a></li>
      <li role="presentation"><a href="settings.php">Settings</a></li>
    </ul>

<div class="container">
  <div class="row">
      <div class="col-md-6"><div class="panel panel-default">
        <div class="panel-heading">
          <h3 class="panel-title"><span class="glyphicon glyphicon-fire" aria-hidden="true"></span> Temperature <span id="temp_flag"></span></h3>
        </div>
        <div class="panel-body">
          <span id="temp_field"></span>
        </div>
      </div>
    </div>
        <div class="col-md-6"><div class="panel panel-default">
          <div class="panel-heading">
          <h3 class="panel-title"><span class="glyphicon glyphicon-time" aria-hidden="true"></span> Uptime <span id="uptime_flag"></span></h3>
        </div>
        <div class="panel-body">
          <h3><span id="uptime_field"></span></h3>
        </div>
      </div>
  </div>
</div>
<hr>
<div class="row">
    <div class="col-md-6"><div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title"><span class="glyphicon glyphicon-random" aria-hidden="true"></span> CPU Usage <span id="cpu_flag"></span></h3>
      </div>
      <div class="panel-body">
        <h3>Load <span id="avrg_load_field"></span></h3>
        <h3>Multicore <span id="multicore_field"></span>%</h3>
        <h3>Singlecore <span id="singlecore_field"></span>%</h3>
      </div>
    </div>
  </div>
      <div class="col-md-6">
</div>
</div>

</div>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <!--<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
    <script src="assets/js/push.min.js"></script>

    <!-- Include all compiled plugins (below), or include individual files as needed -->
  </body>
</html>
